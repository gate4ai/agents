# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ "AI Telegram Bot Platform"

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞. –ï–≥–æ —Ü–µ–ª—å ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –µ–¥–∏–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –≤–∫–ª—é—á–∞—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤. –ü—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ **—Å–ª–µ–¥—É–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è** –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –∑–¥–µ—Å—å –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏.

## 1. –û–±—â–∞—è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–º–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ Nuxt.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**, –≥–¥–µ –≤—Å—è –ª–æ–≥–∏–∫–∞ (API, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î) —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏ (`/server`).

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

1.  **–°–µ—Ä–≤–∏—Å-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏–µ, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã (`/server/services`), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–∞–±–æ—Ç–∞ —Å AI, —Å–µ—Å—Å–∏–∏).
2.  **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞:** –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram –ø–æ—Å—Ç—É–ø–∞—é—Ç –Ω–∞ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/server/api/telegram/webhook/[botToken].post.ts`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞.
3.  **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API:** –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (Telegram, OpenAI, Gemini) –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö (`telegramService`, `AIManager`), —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π.
4.  **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (SQLite) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ö–µ–ª–ø–µ—Ä—ã –≤ `/server/db/index.ts`. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—ã) –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ç–∞–º –∂–µ.

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –§–∞–π–ª–æ–≤

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞.

---

### üìÇ `/.github/workflows/`

- **`ci.yml`**: –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ GitHub Actions –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (CI). –ó–∞–ø—É—Å–∫–∞–µ—Ç –ª–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –∏–ª–∏ pull request –≤ –≤–µ—Ç–∫—É `main`.

### üìÇ `/docs/`

- **`ARCHITECTURE.md`**: –≠—Ç–æ—Ç —Ñ–∞–π–ª. –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
- **`Terms of Reference.md`**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç.
- **`testing.md`**: –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤.

### üìÇ `/public/`

- **`robots.txt`**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ä–æ–±–æ—Ç–æ–≤. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é.

### üìÇ `/server/`

–≠—Ç–æ —è–¥—Ä–æ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### üìÇ `/server/api/`

- **`/telegram/webhook/[botToken].post.ts`**: **–ì–ª–∞–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä**.
  - **–†–æ–ª—å:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç –≤–µ–±—Ö—É–∫–æ–≤ Telegram.
  - **–õ–æ–≥–∏–∫–∞:**
    1.  –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω (`X-Telegram-Bot-Api-Secret-Token`).
    2.  –ü–∞—Ä—Å–∏—Ç —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (`TelegramUpdate`).
    3.  –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (–∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç).
    4.  –í—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã (`handleStartCommand`, `handleSetPromptCommand` –∏ —Ç.–¥.) –∏–ª–∏ –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ (`handleTextMessage`).
    5.  –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è.

#### üìÇ `/server/db/`

- **`index.ts`**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite.
  - **–†–æ–ª—å:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.
  - **–°–æ–¥–µ—Ä–∂–∏—Ç:**
    - `initializeDatabase()`: –§—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ë–î. **–ó–¥–µ—Å—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î (`CREATE TABLE ...`)**.
    - `getDB()`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Å—Ç–∞–Ω—Å –ë–î.
    - `runQuery`, `getQuery`, `allQuery`: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
- **`seedBots.ts`**: –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `bots` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`TELEGRAM_BOT_1_TOKEN` –∏ —Ç.–¥.).

#### üìÇ `/server/plugins/`

- **`database.ts`**: Nitro-–ø–ª–∞–≥–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ `initializeDatabase()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ë–î –∫ –ø—Ä–∏–µ–º—É –∑–∞–ø—Ä–æ—Å–æ–≤, **–∞ —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (`schedulerService`)**.

#### üìÇ `/server/services/`

–ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–∞—è –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã.

##### üìÇ `/server/services/ai/`

- **`AIManager.ts`**: **Singleton-—Ñ–∞–±—Ä–∏–∫–∞** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI.
  - **–†–æ–ª—å:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`generateTextResponse`) –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã, —Å–∫—Ä—ã–≤–∞—è –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
  - **–õ–æ–≥–∏–∫–∞:** –ù–∞ –æ—Å–Ω–æ–≤–µ `runtimeConfig.aiProvider` (`openai` –∏–ª–∏ `gemini`) —Å–æ–∑–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
- **`ASRManager.ts`**: **Singleton-—Ñ–∞–±—Ä–∏–∫–∞** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π –∞—É–¥–∏–æ.
  - **–†–æ–ª—å:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`transcribeAudio`) –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
  - **–õ–æ–≥–∏–∫–∞:** –ù–∞ –æ—Å–Ω–æ–≤–µ `runtimeConfig.asrProvider` (`openai` –∏–ª–∏ `google`) —Å–æ–∑–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
- **`types.ts`**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–±—â–∏–µ —Ç–∏–ø—ã –¥–ª—è AI-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (`ChatMessage`, `AIProvider`), –≤–∫–ª—é—á–∞—è –º–µ—Ç–æ–¥ `transcribeAudio` –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∞—É–¥–∏–æ.
- **`/providers/openai.ts`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `AIProvider` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI API, –≤–∫–ª—é—á–∞—è Whisper –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
- **`/providers/gemini.ts`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `AIProvider` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Gemini API –∏ Google Cloud Speech-to-Text –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.

##### üìÇ `/server/services/commands/`

- **`startCommandHandler.ts`**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/start`. –í—ã–∑—ã–≤–∞–µ—Ç `findOrCreateUser`.
- **`setPromptCommandHandler.ts`**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/setprompt`. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–≤—è–∑–∫–∏ "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–±–æ—Ç".
- **`myBotsCommandHandler.ts`**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/mybots`. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ—Ç–æ–≤ –∏ –∏—Ö —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

##### –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

- **`authService.ts`**:
  - **–†–æ–ª—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
  - **–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:** `findOrCreateUser(telegramUser)` ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ `telegram_id` –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ, –µ—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î.
- **`botUserService.ts`**:
  - **–†–æ–ª—å:** –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤—è–∑—è–º–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –±–æ—Ç–∞–º–∏ –∏ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (–ø—Ä–æ–º–ø—Ç–∞–º–∏).
  - **–§—É–Ω–∫—Ü–∏–∏:** `getBotByToken`, `getUserBotPrompt`, `setUserBotPrompt` –∏ —Ç.–¥.
- **`messageHandler.ts`**:
  - **–†–æ–ª—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –Ω–µ-–∫–æ–º–∞–Ω–¥–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
  - **–õ–æ–≥–∏–∫–∞:**
    1.  –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–æ—Ç–∞ –∏–∑ –ë–î.
    2.  –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –∏–∑ `sessionService`.
    3.  –ü–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–∫–∞—Å—Ç–æ–º–Ω—ã–π –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
    4.  –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ `AIManager`.
    5.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ `telegramService`.
    6.  –û–±–Ω–æ–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –≤ `sessionService`.
- **`sessionService.ts`**:
  - **–†–æ–ª—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–∏–∞–ª–æ–≥–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏.
  - **–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
    - `getSession(chatId)`: –ü–æ–ª—É—á–∞–µ—Ç —Å–µ—Å—Å–∏—é —á–∞—Ç–∞, –≤–∫–ª—é—á–∞—è –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π.
    - `updateHistory(...)`: –û–±–Ω–æ–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–º–µ–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞–º–∏.
- **`schedulerService.ts`**:
  - **–†–æ–ª—å**: –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –æ–ø—Ä–æ—Å–∞ –ë–î (DB-polling) –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π.
- **`telegramService.ts`**:
  - **–†–æ–ª—å:** –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ Telegram Bot API.
  - **–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
    - `sendMessage(botToken, chatId, text)` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    - `getFileInfo(botToken, fileId)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –ø–æ ID.
    - `downloadFile(botToken, filePath)` ‚Äî —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram.
- **`voiceHandler.ts`**:
  - **–†–æ–ª—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
  - **–õ–æ–≥–∏–∫–∞:**
    1. –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ–ª–æ—Å–æ–≤–æ–º —Ñ–∞–π–ª–µ —á–µ—Ä–µ–∑ `getFileInfo`.
    2. –°–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª —á–µ—Ä–µ–∑ `downloadFile`.
    3. –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ `ASRManager`.
    4. –ü–µ—Ä–µ–¥–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ `handleTextMessage` –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

#### üìÇ `/server/types/`

- **`telegram.ts`**: TypeScript-—Ç–∏–ø—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ Telegram API (`TelegramUpdate`, `TelegramMessage`, `TelegramUser`, `TelegramVoice`).

#### üìÇ `/server/utils/`

- **`logger.ts`**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞ `pino` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏ —É–¥–æ–±–æ—á–∏—Ç–∞–µ–º–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

---

### üìÇ `/test/`

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ç–µ—Å—Ç–∞–º–∏.

- **`setup.ts`**: –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è `vitest`. –ú–æ–∫–∏—Ä—É–µ—Ç `useRuntimeConfig` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ –æ—á–∏—Å—Ç–∫–æ–π —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤.
- **`/e2e/`**: End-to-end —Ç–µ—Å—Ç—ã. –ü—Ä–æ–≤–µ—Ä—è—é—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É —Ü–µ–ª–∏–∫–æ–º —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ API.
- **`/unit/`**: Unit-—Ç–µ—Å—Ç—ã. –ü—Ä–æ–≤–µ—Ä—è—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã –≤ –∏–∑–æ–ª—è—Ü–∏–∏.
- **`/mocks/`**: –ú–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Telegram, OpenAI) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `msw` (Mock Service Worker).

–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –æ–±–ª–∞—Å—Ç–µ–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ [docs/testing.md](./testing.md).

---

### üìÑ –ö–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã

- **`nuxt.config.ts`**: –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Nuxt.js. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–æ–¥—É–ª–∏, `runtimeConfig` (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∞—è `asrProvider` –∏ `googleCloudKeyFile`), –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Vite –∏ —Ç.–¥.
- **`package.json`**: –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (`npm run test`, `npm run dev`).
- **`vitest.config.ts`**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ `vitest`.
